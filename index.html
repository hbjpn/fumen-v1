<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<script type="text/javascript"
	src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
<script type="text/javascript" src="fumen.js"></script>
<link rel="stylesheet" href="fumen_font.css">
<style type="text/css">
@media print{
	#form {
		display: none;
	}
}

#score_code {
	font-family: "Courier New", Courier, "Lucida Console", Monaco, monospace;
	font-size: 13px;
	padding: 10px;
}
</style>
<script type="text/javascript">
var dpi = 96; // dot/inch
var A4_width_mm = 210; 
var A4_height_mm = 297;
var mm_inch = 25.4; // mm/inch
var paper_width = dpi * A4_width_mm / mm_inch;
var paper_height = dpi * A4_height_mm / mm_inch;

function Generate()
{
	var code = $("#score_code").val();
	var async_mode = $('input[name="blocking"]:checked').val() == "non-blocking";
	var showProgress = false;
	
	var p = new Fumen.Parser(function(msg){ console.log(msg); });
	if(async_mode){
		try{
			var track = p.parse(code);
			var renderer = new Fumen.Renderer($("#scorecanvas"), paper_width, paper_height);
			renderer.clear();
			var task = renderer.render(track, async_mode, showProgress);
		}catch(e){
			console.log("Exception catched : " + e);
			alert(e);
			throw e;
			return;
		}

		task.then(function(r){
			
		});
	}else{
		console.log("Rendering ... ");
		setTimeout(function(){
			try{
				var track = p.parse(code);
				var renderer = new Fumen.Renderer($("#scorecanvas"), paper_width, paper_height);
				renderer.clear();
				var task = renderer.render(track, async_mode, showProgress);
			}catch(e){
				console.log("Exception catched : " + e);
				alert(e);
				throw e;
				return;
			}
		}, 100); // Invoke later
	}
}

</script>
<body>
<div id="form">
<div style="font-size:34px; text-align:center;">fumen hosting</div>
<div style="text-align:center;">This is fumen hosting site ! Please see <a href="http://hbjpn.github.io/fumen/" target="_blank">here</a> for fumen markdown.</div>
<textarea id="score_code" style="width:100%; height:400px; ">
%TITLE="Sample Piece"
%ARTIST="Some artists"

[Intro]
| F#    |      |       |       |

[A]
||: <S> F#   | B/F#  Bm/F#  | F#   | Bb7   |
| Ebm F#/C#  | Cdim  | G#m  | C#7  :||

[B]
| F#   | Bbm  | B    | Bm   |
| F#   | Bbm  | B    | Bm   |
| D C# B <to Coda> |

[C]
||: F#   |     | G#7    |       |
| Bm   | C#7   |
|[1] B  F#  | D  E  :||
|[2] B F#/A# | C#/G#  | C#/F   | C#     |

[M]
| F#    | F#   <D.S. al Coda> |

[C2]
||: <Coda> F#   |     | G#    |       |
| Bm   | C#7   |
|[1] B  F#  | D  E  :||
|[2] F#  | G#7  | Bm  | C#13     |
| F#  | G#7  | Bm  | 
| C#13    | Bbm  | C#/G#  |
| D    | E/B   |       | F#   |      | DM7   |
</textarea>
<hr/>
<input type="radio" name="blocking" value="blocking" checked="checked">Blocking</input>
<input type="radio" name="blocking" value="non-blocking">Non-Blocking</input>
<button onClick="Generate()">Render</button>
<p>To generate PDF file, please use print feature of your web browser. ( Select "save as pdf" )
<hr/>
</div>
<div style="background-color:gray; padding:10px;">
<div id="scorecanvas"></div>
</div>
<div id="invisible_view" style="opacity: 0;"></div>
</body>
</html>
